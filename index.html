<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOAP形式 薬歴作成支援ツール</title>
    <style>
        body { 
            font-family: sans-serif; 
            margin: 10px;
        }
        h1, h2 {
            font-size: 1.2em;
            border-bottom: 1px solid #ccc;
            margin-top: 20px;
        }
        textarea, input[type="text"] {
            width: 98%;
            font-size: 1em;
            margin-top: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .disease-selector button, .quick-btn, .btn, .copy-btn {
            font-size: 1em;
            margin: 2px;
            padding: 5px;
            border: 1px solid #000;
            background: #eee;
            cursor: pointer;
        }
        .disease-selector .active {
            background: #000;
            color: #fff;
        }
        .quick-btn-area {
            margin-top: 5px;
        }
        #soap-output {
            white-space: pre-wrap;
            background: #f4f4f4;
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 150px;
        }
    </style>
</head>
<body>

    <h1>SOAP形式 薬歴作成支援ツール</h1>

    <div class="disease-selector">
        <button class="disease-btn active" data-disease="cold">風邪</button>
        <button class="disease-btn" data-disease="hypertension">高血圧</button>
        <button class="disease-btn" data-disease="diabetes">糖尿病</button>
        <button class="disease-btn" data-disease="dyslipidemia">脂質異常症</button>
        <button class="disease-btn" data-disease="arrhythmia">不整脈</button>
    </div>

    <div class="form-group">
        <label for="symptoms"><b>S) 患者の症状 (Subjective)</b></label><br>
        <textarea id="symptoms" rows="4"></textarea>
        <div class="quick-btn-area" id="symptoms-btns"></div>
    </div>

    <div class="form-group">
        <label for="objective"><b>O) 客観的所見 (Objective)</b></label><br>
        <textarea id="objective" rows="4"></textarea>
        <div class="quick-btn-area" id="objective-btns"></div>
    </div>

    <div class="form-group">
        <label for="assessment"><b>A) 評価 (Assessment)</b></label><br>
        <textarea id="assessment" rows="4"></textarea>
        <div class="quick-btn-area" id="assessment-btns"></div>
    </div>

    <div class="form-group">
        <label for="medication"><b>P) 処方薬・指導 (Plan)</b></label><br>
        <input type="text" id="medication" placeholder="処方薬を入力"><br>
        <textarea id="plan_details" rows="4" placeholder="指導内容を入力"></textarea>
        <div class="quick-btn-area" id="plan_details-btns"></div>
    </div>

    <button id="generateBtn" class="btn">SOAP薬歴を生成</button>

    <h2>生成された薬歴 (SOAP)</h2>
    <button id="copyBtn" class="copy-btn">テキストをコピー</button>
    <pre id="soap-output">ここに入力内容に基づいたSOAP形式のテキストが生成されます。</pre>

    <script>
        const quickButtonData = {
            'cold': {
                'symptoms': ['咳', '痰', '鼻水', '鼻づまり', '喉の痛み', '発熱', '悪寒', '倦怠感', '頭痛', '関節痛'],
                'objective': ['咽頭発赤あり', '鼻汁あり', '体温:___℃', '来局時、活気なし', '処方医に連絡し、状況報告'],
                'assessment': ['感冒による症状と推測', '処方内容は対症療法として適切', '細菌感染の合併は現時点では否定的', '十分な休養と栄養補給が重要', '副作用発現なし'],
                'plan_details': ['用法・用量を説明', '眠気、ふらつき等の副作用を説明', '症状が改善しない、または悪化する場合は再受診を推奨', '十分な水分補給と休養を指導', 'お大事に']
            },
            'hypertension': {
                'symptoms': ['特に自覚症状なし', '頭痛', 'めまい', 'ふらつき', '家庭血圧は___/___mmHg前後', '服薬コンプライアンス良好', '塩分を控えている', '運動を心がけている'],
                'objective': ['家庭血圧手帳を持参', '来局時血圧:___/___mmHg', '残薬なし', '副作用（咳、めまい、浮腫等）の訴えなし'],
                'assessment': ['家庭血圧でのコントロール良好', '降圧目標（診察室/家庭）達成', '副作用なく、処方は適切と判断', '服薬アドヒアランス良好', '生活習慣の改善努力が見られる'],
                'plan_details': ['継続服用とアドヒアランスの重要性を説明', '家庭での血圧測定と記録の継続を指導', '減塩・運動等の生活習慣の継続を推奨', '副作用の初期症状（めまい、咳、むくみ等）を再確認', '次回の受診予定を確認']
            },
            'diabetes': {
                'symptoms': ['特に自覚症状なし', 'のどの渇き', '多尿', '体重の変化', '手足のしびれ・痛みはない', '低血糖症状（冷や汗、動悸、手の震え）なし', '食事療法を実践', '運動療法を実践'],
                'objective': ['HbA1c:___%', '血糖値:___mg/dL', 'お薬手帳持参', '残薬なし', 'インスリン手技問題なし', 'フットケア実施状況良好'],
                'assessment': ['血糖コントロール状態は目標範囲内', '低血糖のリスクは低い', '合併症（網膜症、腎症、神経障害）の兆候なし', 'シックデイルールを理解している', '服薬アドヒアランス良好'],
                'plan_details': ['継続服用の重要性を説明', '低血糖症状の症状と対処法（ブドウ糖摂取）を再確認', 'シックデイルールの対応について再確認', '定期的な足の観察（フットケア）を指導', '次回の受診予定と検査予定を確認']
            },
            'dyslipidemia': {
                'symptoms': ['特に自覚症状なし', '食事内容に注意している', '定期的に運動している', '筋肉痛、脱力感、こわばり等の症状なし', '服薬コンプライアンス良好'],
                'objective': ['LDL-C:___mg/dL', 'TG:___mg/dL', 'HDL-C:___mg/dL', 'CK値異常なし', '残薬なし'],
                'assessment': ['脂質管理目標値を達成', '副作用（横紋筋融解症等）の兆候なし', '処方は適切と判断', '服薬アドヒアランス良好', '生活習慣改善の意識が高い'],
                'plan_details': ['継続服用の重要性を説明', '横紋筋融解症の初期症状（筋肉痛、脱力感、赤褐色尿等）を再確認し、発現時はすぐに相談するよう指導', '食事・運動療法の継続を推奨', 'グレープフルーツジュースとの相互作用について説明', '次回の受診予定を確認']
            },
            'arrhythmia': {
                'symptoms': ['動悸', '息切れ', 'めまい', '胸部不快感', '特に自覚症状なし', '出血傾向（鼻血、歯肉出血、皮下出血）なし', '服薬コンプライアンス良好'],
                'objective': ['脈拍:___bpm(整/不整)', 'PT-INR:___(ワルファリン服用時)', 'DOAC服用中のためモニタリング項目なし', '残薬なし', 'お薬手帳で併用薬確認'],
                'assessment': ['心拍数はおおむね目標範囲内', '脳梗塞のリスク管理は良好', '重大な出血事象のリスクは低い', '副作用（出血、消化器症状等）なし', '服薬アドヒアランス良好'],
                'plan_details': ['抗凝固薬の継続服用の重要性を説明', '出血傾向（鼻血、歯肉出血、あざ等）に注意し、持続する場合は受診するよう指導', '併用薬（特にNSAIDs、抗血小板薬）について注意喚起', '納豆、クロレラ、青汁など食事との相互作用を再確認（ワルファリン）', '次回の受진予定を確認']
            }
        };

        function updateQuickButtons(disease) {
            const buttonMapping = {
                'symptoms': 'symptoms-btns',
                'objective': 'objective-btns',
                'assessment': 'assessment-btns',
                'plan_details': 'plan_details-btns'
            };

            for (const [key, btnAreaId] of Object.entries(buttonMapping)) {
                const area = document.getElementById(btnAreaId);
                area.innerHTML = '';
                const buttons = quickButtonData[disease][key] || [];
                buttons.forEach(text => {
                    const button = document.createElement('button');
                    button.className = 'quick-btn';
                    button.textContent = text;
                    button.dataset.target = key === 'plan_details' ? 'plan_details' : key;
                    area.appendChild(button);
                });
            }
        }

        document.querySelector('.disease-selector').addEventListener('click', (e) => {
            if (e.target.classList.contains('disease-btn')) {
                document.querySelectorAll('.disease-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                const selectedDisease = e.target.dataset.disease;
                updateQuickButtons(selectedDisease);
            }
        });

        document.querySelector('body').addEventListener('click', function(e) {
            if (e.target.classList.contains('quick-btn')) {
                const targetId = e.target.dataset.target;
                const textToAdd = e.target.textContent;
                const targetTextarea = document.getElementById(targetId);
                
                if (targetTextarea.value.trim() === '') {
                    targetTextarea.value += textToAdd;
                } else {
                    targetTextarea.value += ' ' + textToAdd;
                }
                targetTextarea.focus();
            }
        });

        document.getElementById('generateBtn').addEventListener('click', function() {
            const symptoms = document.getElementById('symptoms').value.trim();
            const objective = document.getElementById('objective').value.trim();
            const assessment = document.getElementById('assessment').value.trim();
            const medication = document.getElementById('medication').value.trim();
            const planDetails = document.getElementById('plan_details').value.trim();

            let planText = '';
            if (medication) {
                planText += `・${medication}を処方。\n`;
            }
            if (planDetails) {
                planText += `・${planDetails}\n`;
            }
            planText += '・患者の状態に変化があれば、再度相談するよう伝えた。';

            const soapNote = `S) ${symptoms || '（記載なし）'}\n\nO) ${objective || '（記載なし）'}\n\nA) ${assessment || '（記載なし）'}\n\nP) \n${planText}`;

            document.getElementById('soap-output').textContent = soapNote;
        });

        document.getElementById('copyBtn').addEventListener('click', function() {
            const outputText = document.getElementById('soap-output').textContent;
            navigator.clipboard.writeText(outputText).then(() => {
                alert('薬歴をクリップボードにコピーしました。');
            }).catch(err => {
                alert('コピーに失敗しました。');
                console.error('Could not copy text: ', err);
            });
        });

        updateQuickButtons('cold');
    </script>

</body>
</html>